<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Robot Turtle</title>
  </head>
<body style="overflow: hidden; margin: 0; padding: 0;">
<canvas id="canvas" width="500" height="500" style="
  margin: 0;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  "></canvas>

<p id="XY">
  X = 0
  Y = 0
</p>

<button onclick="rotatePath()">Rotate Path</button>

<!--
<button onclick="getPoints()">Get List 'o Points</button>
-->

Upload Points:
<input type="file" id="inputfile">

<script type="text/javascript">
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext('2d');
ctx.imageSmoothingEnabled = false;

var scale = 1;
var logoX = 0;
var logoY = 0;
var logo = new Image;
  logo.src = "7316SVG.svg";
  logo.onload = function() { render() };

//stores array of points and figure START markers
var path;
var pathScaled = [];

function parsePath(s) {
  s = s.replaceAll("\r", "");  //carriage return
  s = s.replaceAll("\s", "");  //whitespace

  path = s.split("\n");
  //console.log(path);

  for (var i = 0; i < path.length; i++) {
    pathScaled.push(path[i]);
  }

  render();
  render();  //IDK why have to call a couple times for stuff to show up
}

//===========Read A User Points Path File================
document.getElementById('inputfile')
   .addEventListener('change', function() {

   var fr = new FileReader();
   fr.onload = function() {
     //console.log(fr.result);
     parsePath(fr.result);
   }

   fr.readAsText(this.files[0]);
});

function rotatePath() {
  if(path != undefined) {
    for (var i = 0; i < path.length; i += 2) {
      if (path[i] == "START") {
        i++;
      }

      var x = Number(path[i]);
      var y = Number(path[i + 1]);
      path[i] = -y;
      path[i + 1] = x;

      var centerX = (canvas.width - canvas.width * scale) / 2;
      var centerY = (canvas.height - canvas.height * scale) / 2;

      pathScaled[i] = path[i] * scale - centerX;
      pathScaled[i + 1] = path[i + 1] * scale - centerY;
    }
    render();
    render();
  }
}

function render(){
  //draw background
  ctx.fillStyle = "white";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  //draw axis
  ctx.fillStyle = "red";
  ctx.fillRect(canvas.width/2 - 1, 0, 3, canvas.height);
  ctx.fillRect(0, canvas.height/2 - 1,  canvas.width, 3);

  //draw image
  if (path == undefined) {
    var centerX = (canvas.width - canvas.width * scale) / 2;
    var centerY = (canvas.height - canvas.height * scale) / 2;
    ctx.drawImage(logo, centerX, centerY, canvas.width * scale, canvas.height * scale);
  } else {
    //draw path
    var stepSize = 2;
    for (var i = 0; i < pathScaled.length; i += stepSize) {
      if (pathScaled[i] != "START") {
        stepSize = 2;
        ctx.lineTo(Number(pathScaled[i]), Number(pathScaled[i + 1]));
      } else {
        stepSize = 3;
        //finish old figure
        ctx.closePath();
        ctx.stroke();

        //START new figure
        ctx.beginPath();
        ctx.moveTo(Number(pathScaled[i + 1]), Number(pathScaled[i + 2]));

        ctx.fillRect(Number(pathScaled[i + 1]), Number(pathScaled[i + 2]), 2, 2);
        //console.log("sttart")
      }
    }
  }
}

/*
//each arrary stored in shapes list is a seperate shape
//pen stays down in each shape, goes up between shapes
var shapesList = [];

//calculates all the points the turtle will have to drive through in order
//traces the outside of the shape based on if there is still black in a three by three box
//around tracer
function getPoints() {
  imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  rgbaData = imgData.data;

  //to distinguish between individual shapes
  shapeDelimiter = 5;  //how many blank lines in between to classify as a shape
  blankLineCounter = 0;
  shape = 0;
  shapesList[shape] = [];

  for (var y = canvas.height; y > 0; y--) {  //loop through each scanline of canvas
    //loop through scanline pixels
    var scanline = y * canvas.width * 4;  //RGBA

    for (var x = 0; x < canvas.width; x++) {
      //if pixel black save that index
      blankLineCounter++;

      if (rgbaData[scanline + x * 4] == 0 && rgbaData[scanline + x * 4 + 1] == 0 && rgbaData[scanline + x * 4 + 2] == 0) {
        var scaledX = (x - canvas.width/2) * 70.25/(canvas.width/2);
        var scaledY = -(y - canvas.height/2) * 70.25/(canvas.height/2);
        document.write("(" + scaledX + ", " + scaledY + ")<br>" );

        shapesList[shape].push(scaledX);
        shapesList[shape].push(scaledY);

        blankLineCounter = 0;
      }
    }

    if (blankLineCounter >= shapeDelimiter) {
      shape++;
      shapesList[shape] = [];
    }
  }

  console.log(shapesList);
}
*/

canvas.addEventListener('mousedown', function(e) {
  var rect = canvas.getBoundingClientRect();
  //gets points based on middle of canvas being (0,0)
  var mX = e.x - rect.left - canvas.width/2;
  var mY = e.y - rect.top - canvas.height/2;
  //console.log(mX + ", " + mY);
  var scaledX = mX * (70.25/(canvas.width/2));
  var scaledY = -1 * mY * (70.25/( canvas.height/2));
  document.getElementById("XY").innerText = "X = " + scaledX + " Y = " + scaledY;
});

canvas.addEventListener('mousemove', function(e) {

});

canvas.addEventListener('mouseup', function(e) {

});

canvas.addEventListener("mousewheel", function(e) {
  scale += -e.deltaY / 1000;

  if (path != undefined) {
    var centerX = (canvas.width - canvas.width * scale) / 2;
    var centerY = (canvas.height - canvas.height * scale) / 2;

    for (var i = 0; i < path.length; i += 2) {
      if (path[i] == "START")
        i++;

      pathScaled[i] = path[i] * scale - centerX;
      pathScaled[i+1] = path[i+1] * scale - centerY;
    }
  }

  // console.log(scale)
  //logo.style.backgroundColor = scale;
  //logo.setAttribute("transform", "scale(" + scale + ")");

  render();
  render();
});

canvas.addEventListener('contextmenu', function(e) {
   event.preventDefault();  //stop right click menu showin up
   //var mX = e.x - rect.left - canvas.width/2;
   //var mY = e.y - rect.top - canvas.height/2;
});

</script>
</body>
</html>
